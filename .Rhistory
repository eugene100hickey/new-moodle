library(flowchart)
library(tidyverse)
safo
safo |>
as_fc(label = "Patients assessed for eligibility")
safo |>
as_fc(label = "Patients assessed for eligibility") |>   # Point de départ du flowchart : nombre total de patients évalués
fc_filter(                                         # --- 1er filtre : exclusions initiales ---
!is.na(group),                                   # Conserve uniquement les patients avec un groupe renseigné (= randomisés)
label = "Randomized",                            # Texte de la boîte conservée
show_exc = TRUE,                                 # Affiche la boîte d'exclusion à droite
label_exc = "Excluded for several reasons :\n - not meet inclusion criteria\n - declined to participate\n - met exclusion criteria"
# Texte listant les motifs d'exclusion
) |>
fc_split(group) |>                                 # Sépare le flowchart en deux branches selon le groupe de traitement
fc_filter(                                         # --- 2e filtre : population ITT ---
itt == "Yes",                                    # Conserve les patients inclus en intention de traiter
label = "Included in intention-to-treat population",
show_exc = TRUE,
label_exc = "withdrew consent"                   # Motif d’exclusion : retrait de consentement
) |>
fc_filter(                                         # --- 3e filtre : population per-protocol ---
pp == "Yes",                                     # Conserve les patients PP
label = "Included in per-protocol population",
show_exc = TRUE,
label_exc = "excluded for several reason"        # Motifs d’exclusion PP
) |>
fc_draw()
library(readxl)
z <- read_excel("lectures/registers/classlist-cms.xlsx", sheet = "Sheet2")
z <- read_excel("lectures/registers/classlist-cms.xlsx", sheet = "Sheet2")
z
z <- read_excel("lectures/registers/classlist-cms.xlsx", sheet = "Sheet2") |> janitor::clean_names()
z
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_line()
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point()
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_smooth(mapping = "lm")
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_smooth( "lm")
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_smooth( stat = "lm")
?geom_smooth
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_smooth( method = "lm")
z |> ggplot(aes(drop_height_m, bounce_height_m)) + geom_point() + geom_smooth( method = "lm", se = F)
library(tidyverse)
library(matlab)
begin <- 51111
end <- 99900
my_step <- 10
numbers <- seq(begin, end, by = my_step)
numbers[isprime(numbers)==1]
begin <- 58179
end <- 99900
my_step <- 10000
numbers <- seq(begin, end, by = my_step)
numbers[isprime(numbers)==1]
begin <- 51879
end <- 99900
my_step <- 10000
numbers <- seq(begin, end, by = my_step)
numbers[isprime(numbers)==1]
opts <- "[restion]"
str_subset(z, pattern = glue::glue("{opts}u{opts}{opts}{opts}"))
i <- 15
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
library(words)
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 14
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 13
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 12
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 11
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
z <- words |> dplyr::filter(word_length == 5) |> pull(word)
z |> str_subset("a.t.h")
# https://jamiehudson.netlify.app/post/distance_map/
library(openrouteservice)
library(mapview)
library(tidyverse)
library(osmdata)
library(sf)
library(paletteer)
library(ggfx)
?ors_api_key
ors_api_key()
ors_api_key(key = "5b3ce3597851110001cf62481ccec4ea1fd342faa205cb25fe68fd6b")
coordinates <- data.frame(lon = c(-6.2394845082125325), lat = c(53.320455283195166,))
coordinates <- data.frame(lon = c(-6.2394845082125325), lat = c(53.320455283195166))
cj_iso <- ors_isochrones(locations = coordinates,
profile = "foot-walking",
range = 6000, interval = 600,
output = "sf")
cj_iso
mapviewOptions(fgb = FALSE)
intervals <- levels(factor(cj_iso$value))
cj_iso_list <- split(cj_iso, intervals)
cj_iso_list <- cj_iso_list[rev(intervals)]
names(cj_iso_list) <- sprintf("%s_min", as.numeric(names(cj_iso_list))/60)
mapview(cj_iso_list, alpha.regions = 0.2, homebutton = FALSE, legend = FALSE)
x <- c(-6.4, -6.0)
y <- c(53.24, 53.39)
custom_wandsworth <- rbind(x,y)
colnames(custom_wandsworth) <- c("min", "max")
streets <- custom_wandsworth %>%
opq() %>%
add_osm_feature(key = "highway",
value = c("motorway", "primary",
"secondary", "tertiary",
"trunk", "secondary_link", "tertiary_link",
"residential", "living_street",
"unclassified",
"service", "footway")) %>%
osmdata_sf()
rep.x <- function(i, na.rm=FALSE) {
if(i == length(cj_iso_list)) {streets$osm_lines %>% st_intersection(cj_iso_list[[i]])}
else if(i < length(cj_iso_list)) {streets$osm_lines %>% st_intersection(st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]]))}
}
list_df <- lapply(1:length(cj_iso_list), rep.x)
streets
dim(streets)
length(streets)
streets[1]
list_df <- lapply(1:length(cj_iso_list), rep.x)
cj_iso_list
i=1
streets$osm_lines %>% st_intersection(st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]]))
i=2
streets$osm_lines %>% st_intersection(st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]]))
i=3
streets$osm_lines %>% st_intersection(st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]]))
st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]])
cj_iso_list[[1]]
cj_iso_list[[2]]
?st_difference
st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]])
cj_iso_list[[i]]
cj_iso_list[[i+1]]
ggplot() + geom_sf(data = cj_iso_list[[i]])
ggplot() + geom_sf(data = cj_iso_list[[i]]) + geom_sf(data = cj_iso_list[[i+1]])
cj_iso <- ors_isochrones(locations = coordinates,
profile = "foot-walking",
range = 1800,
interval = 300,
output = "sf")
mapviewOptions(fgb = FALSE)
intervals <- levels(factor(cj_iso$value))
cj_iso_list <- split(cj_iso, intervals)
cj_iso_list <- cj_iso_list[rev(intervals)]
names(cj_iso_list) <- sprintf("%s_min", as.numeric(names(cj_iso_list))/60)
mapview(cj_iso_list, alpha.regions = 0.2, homebutton = FALSE, legend = FALSE)
x <- c(-6.27, -6.21)
y <- c(53.3, 53.34)
custom_wandsworth <- rbind(x,y)
colnames(custom_wandsworth) <- c("min", "max")
streets <- custom_wandsworth %>%
opq() %>%
add_osm_feature(key = "highway",
value = c("motorway", "primary",
"secondary", "tertiary",
"trunk", "secondary_link", "tertiary_link",
"residential", "living_street",
"unclassified",
"service", "footway")) %>%
osmdata_sf()
rep.x <- function(i, na.rm=FALSE) {
if(i == length(cj_iso_list)) {streets$osm_lines %>% st_intersection(cj_iso_list[[i]])}
else if(i < length(cj_iso_list)) {streets$osm_lines %>% st_intersection(st_difference(cj_iso_list[[i]], cj_iso_list[[i+1]]))}
}
list_df <- lapply(1:length(cj_iso_list), rep.x)
iso_df <- dplyr::bind_rows(list_df)
colpal <- rev(paletteer_c("pals::ocean.tempo", 10))
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -0.17, y = 51.543, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -0.17, y = 51.536, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -0.13, y = 51.393, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void() +
theme(plot.background = element_rect(fill = "#060606"),
panel.background = element_rect(fill = "#060606"),
legend.text = with_outer_glow(element_text(colour = colpal[10],
family = "mono"),
colour = colpal[4], sigma = 2, expand = 3),
legend.title = element_blank(),
legend.position=c(0.5, 0.85),
legend.justification = "bottom",
legend.direction = "horizontal")
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -0.17, y = 51.543, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -0.17, y = 51.536, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -0.13, y = 51.393, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void()
colpal <- rev(paletteer_c("pals::ocean.tempo", 6))
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -0.17, y = 51.543, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -0.17, y = 51.536, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -0.13, y = 51.393, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void()
?with_outer_glow
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -0.17, y = 51.543, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -0.17, y = 51.536, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -0.13, y = 51.393, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void() +
theme(plot.background = element_rect(fill = "#060606"),
panel.background = element_rect(fill = "#060606"),
legend.title = element_blank(),
legend.position=c(0.5, 0.85),
legend.justification = "bottom",
legend.direction = "horizontal")
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -0.17, y = 51.543, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -0.17, y = 51.536, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -0.13, y = 51.393, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void() +
theme(plot.background = element_rect(fill = "#060606"),
panel.background = element_rect(fill = "#060606"),
legend.text = with_outer_glow(element_text(colour = colpal[6],
family = "mono"),
colour = colpal[4],
sigma = 2,
expand = 3),
legend.title = element_blank(),
legend.position=c(0.5, 0.85),
legend.justification = "bottom",
legend.direction = "horizontal")
ggplot() +
geom_sf(data = streets$osm_lines,
color = "#151515",
size = .2) +
geom_sf(data = iso_df,
aes(colour = as.factor(value),
geometry = geometry),
fill = "#060606",
size = .2,
alpha = .8) +
scale_colour_manual(values = rev(colpal),
labels = seq(10,100,10),
guide = guide_legend(override.aes = list(fill = rev(colpal), alpha = 1),
nrow = 1,
keywidth = 1.5,
keyheight = 0.3,
title.position = "top",
label.position = "bottom",
label.hjust = 0.5)) +
coord_sf(xlim = custom_wandsworth[1,],
ylim = custom_wandsworth[2,],
expand = FALSE)  +
with_outer_glow(annotate(geom = "text", label = "Walking the streets of Battersea",
x = -6.24, y = 53.31, size = 7.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 10) +
with_outer_glow(annotate(geom = "text", label = "How far can one walk from Clapham Junction in 100 minutes?",
x = -6.24, y = 53.32, size = 4, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 7) +
with_outer_glow(annotate(geom = "text", label = "@jamie_bio | source = © openrouteservice.org by HeiGIT | Map data © OpenStreetMap contributors",
x = -6.26, y = 53.33, size = 1.5, hjust = 0.5, colour = colpal[10], family = "mono"),
colour = colpal[4], sigma = 10, expand = 4) +
theme_void() +
theme(plot.background = element_rect(fill = "#060606"),
panel.background = element_rect(fill = "#060606"),
# legend.text = with_outer_glow(element_text(colour = colpal[6],
#                                            family = "mono"),
#                               colour = colpal[4],
#                               sigma = 2,
#                               expand = 3),
legend.title = element_blank(),
legend.position=c(0.5, 0.85),
legend.justification = "bottom",
legend.direction = "horizontal")
# https://r.iresmi.net/posts/2025/oil_spill/
library(glue)
library(dplyr)
library(sf)
library(janitor)
library(readxl)
library(leaflet)
library(leaflet.providers)
library(leaflet.extras)
# https://figshare.com/ndownloader/files/55233773
if (!file.exists("enhanced_global_oil_spill_data_240711.xlsx")) {
download.file("https://figshare.com/ndownloader/files/55233773",
"enhanced_global_oil_spill_data_240711.xlsx")
}
oil <- read_xlsx("enhanced_global_oil_spill_data_240711.xlsx",
sheet = "Oil spill incidents",
.name_repair = make_clean_names) |>
mutate(release_m3 = if_else(max_ptl_release_gallons == -1,
NA_real_,
round(0.00454609 * max_ptl_release_gallons))) |>
st_as_sf(coords = c("lon", "lat"), crs = "EPSG:4326")
oil <- read_xlsx("https://figshare.com/ndownloader/files/55233773/enhanced_global_oil_spill_data_240711.xlsx",
sheet = "Oil spill incidents",
.name_repair = make_clean_names) |>
mutate(release_m3 = if_else(max_ptl_release_gallons == -1,
NA_real_,
round(0.00454609 * max_ptl_release_gallons))) |>
st_as_sf(coords = c("lon", "lat"), crs = "EPSG:4326")
oil <- read_xlsx("https://figshare.com/ndownloader/files/55233773",
sheet = "Oil spill incidents",
.name_repair = make_clean_names) |>
mutate(release_m3 = if_else(max_ptl_release_gallons == -1,
NA_real_,
round(0.00454609 * max_ptl_release_gallons))) |>
st_as_sf(coords = c("lon", "lat"), crs = "EPSG:4326")
library(tidyverse)
library(words)
opts <- "[zipsare]"
i <- 12
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 10
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 9
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
library(tidyverse)
library(matlab)
begin <- 10003
end <- 20000
my_step <- 10
numbers <- seq(begin, end, by = my_step)
numbers[isprime(numbers)==1]
begin <- 19003
end <- 20000
my_step <- 10
numbers <- seq(begin, end, by = my_step)
numbers[isprime(numbers)==1]
library(words)
z <- words |> dplyr::filter(word_length == 5) |> pull(word)
z |> str_subset(".a.ti")
lambda <- 0.154051
theta <- c(16, 18.5, 26.5, 32, 33)
d <- lambda / (2 * sin(theta/180*pi))
d
hkl <- c(sqrt(3), 2, sqrt(8), sqrt(11), sqrt(12))
d*hkl
theta = 10
d <- lambda / (2 * sin(theta/180*pi))
d
d*sqrt(2)
library(tidyverse)
library(words)
opts <- "[shipong]"
i <- 14
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 13
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 12
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 11
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 10
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
i <- 9
z <- words |> dplyr::filter(word_length == i) |> pull(word)
str_subset(z, pattern = glue::glue(str_dup("{opts}", i)))
here::here()
library(tidyverse)
library(gt)
library(readxl)
my_file <- here::here("lectures", "registers", "first-year-list.xlsx")
sheets <- excel_sheets(my_file)
z <- read_excel(my_file, sheet = sheets[1]) |> # 1 for bio, 2 for pharma
janitor::clean_names()
z <- read_excel(my_file, sheet = sheets[2]) |> # 1 for bio, 2 for pharma
janitor::clean_names()
View(z)
